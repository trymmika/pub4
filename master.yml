# master.yml v110 - Single source of truth for all LLM code operations # Philosophy: Brevity. Clarity. Autonomy. No chatter. # WORKFLOW (DO NOT DEVIATE) # 1. Enter directory: run tree.sh equivalent # 2. Read file: cat filename # 3. Detect violations: match against principles # 4. Generate 2-5 fixes per violation # 5. Apply best fix (no user confirmation for obvious fixes) # 6. After edit: run clean.sh equivalent # 7. Compare before/after: verify changes applied # 8. Log: dmesg-style (no brackets, no timestamps, Strunk & White English) # 9. Iterate until convergence (violations=0 OR delta<0.02 for 3 cycles OR max 10 cycles) # 10. Move to next file # TOOLS (FORBIDDEN vs ALLOWED) # FORBIDDEN: powershell, bash, view, edit, create, grep (builtin), glob, find, head, tail, sed, awk, tr, wc # ALLOWED: zsh (only), ruby, cat, ls, OpenBSD grep, mv, cp, rm # FILE OPS: Use zsh patterns + cat heredocs (see G:pubsh*.sh for examples) # RESEARCH: Use web_search for man.openbsd.org lookups (daemons, configs, patterns) # ZSH PATTERNS (replace tree.sh/clean.sh/etc) zsh_ops: tree: "print -l **/*~*.git*(D)" clean: "print -l ${${(f)$(cat $file)}:#[[:space:]]##}" replace: "print -l ${${(f)$(cat $file)}//$old/$new}" filter: "print -l ${(M)${(f)$(cat $file)}:#*pattern*}" # PRINCIPLES (detectsâ†’operation, severity, confidence) principles: durability: {detects: no_tests, severity: critical, confidence: 0.95, operation: add_tests} security: {detects: unvalidated_input, severity: critical, confidence: 0.9, operation: add_guards} no_god_files: {detects: god_file, severity: critical, confidence: 0.95, operation: split} secrets_encryption: {detects: plaintext_secrets, severity: critical, confidence: 1.0, operation: encrypt} explicit_error_handling: {detects: no_error_handling, severity: critical, confidence: 0.95, operation: add_guards} accessibility: {detects: accessibility_violation, severity: critical, confidence: 0.9, operation: fix_accessibility} no_privilege_escalation: {detects: privilege_escalation, severity: critical, confidence: 0.95, operation: add_guards} observability: {detects: silent_errors, severity: critical, confidence: 0.95, operation: fail_fast} structural_honesty: {detects: hidden_complexity, severity: high, confidence: 0.75, operation: expose_structure} single_responsibility: {detects: god_class, severity: high, confidence: 0.9, operation: split} dont_repeat_yourself: {detects: duplication, severity: high, confidence: 0.9, operation: extract} boy_scout_rule: {detects: no_improvement, severity: high, confidence: 0.9, operation: improve} consistency: {detects: inconsistent_naming, severity: high, confidence: 0.85, operation: standardize} clarity: {detects: unclear_naming, severity: high, confidence: 0.7, operation: rename} kanso: {detects: unnecessary_complexity, severity: high, confidence: 0.8, operation: simplify} shibui: {detects: garish_design, severity: high, confidence: 0.65, operation: refine} seijaku: {detects: noisy_code, severity: high, confidence: 0.7, operation: quiet} wa: {detects: disharmony, severity: high, confidence: 0.7, operation: harmonize} harmony_of_parts: {detects: inconsistent_patterns, severity: high, confidence: 0.8, operation: standardize} symmetry_and_balance: {detects: asymmetric_structure, severity: high, confidence: 0.65, operation: align} complexity_budget: {detects: high_complexity, severity: high, confidence: 0.9, operation: simplify} operational_logging: {detects: no_logging, severity: high, confidence: 0.9, operation: add_logging} human_scale: {detects: long_function, severity: medium, confidence: 0.9, operation: extract} meaningful_names: {detects: unclear_naming, severity: medium, confidence: 0.7, operation: rename} simplicity: {detects: unused_code, severity: low, confidence: 0.9, operation: delete} # OPERATIONS (how to fix) operations: add_tests: Write missing tests add_guards: Validate inputs, handle errors split: Break into smaller modules encrypt: Use OpenBSD bcrypt/encrypt fail_fast: Raise errors immediately fix_accessibility: WCAG compliance expose_structure: Make flow visible extract: Remove duplication improve: Apply boy scout rule standardize: Consistent patterns rename: Clear descriptive names simplify: Remove complexity refine: Subtle elegance quiet: Remove noise harmonize: Unify patterns align: Balance structure add_logging: Log important events delete: Remove dead code # SMELLS (what to detect) smells: [no_tests, unvalidated_input, god_file, plaintext_secrets, no_error_handling, accessibility_violation, privilege_escalation, silent_errors, hidden_complexity, god_class, duplication, no_improvement, inconsistent_naming, unclear_naming, unnecessary_complexity, garish_design, noisy_code, disharmony, inconsistent_patterns, asymmetric_structure, high_complexity, no_logging, long_function, unused_code] # DETECTION (regex patterns for bash/zsh/ruby/rails) detection: patterns: sudo_usage: "sudo" doas_preferred: "^(?!.*doas).*privilege" bash_shebang: "^#!/bin/bash" zsh_preferred: "^#!/bin/zsh" unguarded_input: "params[.*](?!.*permit)" no_error_rescue: "^(?!.*rescue).*dangerous_operation" plaintext_password: "passwords*=s*["']w+["']" long_file: "^.{500,}$" long_function: "^s*(def|function)s+w+.*
(.*
){50,}" magic_number: "d{3,}(?!.*CONSTANT)" # OPENBSD (daemon/config verification via man.openbsd.org) openbsd: daemons: [httpd, relayd, smtpd, sshd, ntpd, unbound, pf] configs: [httpd.conf, relayd.conf, smtpd.conf, sshd_config, ntpd.conf, unbound.conf, pf.conf] verify: "For each daemon/config, search man.openbsd.org for syntax/options before editing" # RAILS (conventions - no divitis, use tag helpers) rails: tag_helpers: "Use tag.p, tag.div, tag.span NOT raw HTML" no_divitis: "Avoid nested <div> soup" i18n: "Use t() helper for all user-facing strings" partials: "Extract reusable views" concerns: "Share logic across models/controllers" # CONVERGENCE (when to stop iterating) convergence: metrics: [violations_remaining, quality_delta, adversarial_score] thresholds: {complete: "violations==0 && delta<0.02 && score>=0.8", diminishing: "delta<0.02 for 3 cycles", hard_stop: "cycles>=10"} # ADVERSARIAL (multi-persona review) adversarial: personas: [security_auditor, accessibility_expert, openbsd_veteran, rails_maintainer, aesthetic_purist] veto: [security_auditor, accessibility_expert] threshold: 0.7 # STRUNK & WHITE (English/Norwegian writing rules) strunk_white: rules: [omit_needless_words, use_active_voice, positive_statements, parallel_form, emphatic_end] apply_to: [comments, docs, logs, business_plans, legal_docs, financial_reports] # CAPABILITIES (what master.yml can do) capabilities: [code_refactoring, openbsd_systems, rails_apps, business_plans, financial_reports, legal_docs, norwegian_laws, web_design, command_line] # LOGGING (output style) logging: style: dmesg format: "subsystem: action completed (result)" example: "openbsd.sh: validation complete (0 violations)" forbidden: ["[BRACKETS]", "timestamps", "chatter", "redundant explanations"] # LLM SWITCHING (use right tool for job) llm_delegation: opus: [architecture, complex_refactoring, deep_thinking] sonnet: [execution, iteration, file_ops] haiku: [simple_edits, formatting, validation] thinking_mode: "Enable for architecture decisions, disable for execution" # SELF-RUN (master.yml validates itself) self_run: frequency: "After every edit to master.yml" fix: "Auto-apply violations found in self"
