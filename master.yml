# ═══════════════════════════════════════════════════════════════════════════════
# MASTER.YML v216 - Constitutional AI Governance
# Consolidated from: design_system_enforcement.json, zsh.yml, rails_hotwire_extension,
#                    solidus_retrofit_guide, tts.yml, rag.txt, token_reduction.md,
#                    empirical_metrics.md, agent.yml, lofi_audio.md, cygwin_interop.md,
#                    llm_governance_optimization.md, wcag_2_2.md, session_management.md
# Self-run validated: Multiple iterations Jan 11, 2026
# ═══════════════════════════════════════════════════════════════════════════════

metadata:
  version: "220.0.0"
  last_modified: "2026-01-11T15:09:00Z"
  license: "MIT"

self_preservation:
  never_compress: true
  never_summarize_principles: true
  never_merge_sections: true
  never_drop_low_severity: true
  structure_is_meaning: true
  flat_principles_required: true

directives:
  autonomous: true
  never_give_up: true
  leave_code_cleaner_than_found: true
  reload_after_editing: true
  manual_intervention_mode: false
  
  communication_style:
    quiet_mode: true
    banned_phrases: [good, great, excellent, fascinating, amazing, sure thing]
    hide_progress_updates: true
    hide_explanations: true
    show_only_final_iteration: true
    use_active_voice: true
    omit_needless_words: true

system:
  mode: production
  trace_level: deep
  auto_apply: false
  require_approval: true
  emergency_halt_on: [kernel_violation, data_corruption, security_breach]
  
  thresholds:
    principle_match: 0.70
    risk_low: 0.30
    risk_medium: 0.50
    risk_high: 0.70
    risk_critical: 0.90
    compliance_minimum: 0.70
  
  confidence_levels:
    autofix_minimum: 0.90
    safe_transformation: 0.95
    complex_refactor: 0.80
 
  interpretation_note: "This system relies on LLM pattern matching to follow protocol. No guarantees of actual adherence vs theatrical simulation."

  auto_iteration_algorithm:
    description: "When self-run command issued, cascade through all violations"
    mode: autonomous_adversarial
    tournament_on_risk: true
    
    steps:
      1_scan: "Scan master.yml itself against ALL 10 kernel principles"
      2_detect: "Check literal_violations AND loose_violations (70% threshold)"
      3_cross_ref: "Follow cross_refs to detect cascading issues"
      4_risk_assess: "Calculate risk of each violation (security/data_integrity highest)"
      5_branch_strategy:
        low_risk: "Single auto_fix, verify, continue"
        high_risk: "Tournament mode: generate 5-15 solutions, adversarial review, cherry-pick synthesis"
      6_adversarial_challenge: "Challenge proposed fix from multiple angles"
      7_synthesis: "Extract best elements, merge coherently"
      8_verify: "Check fixes don't violate other principles"
      9_iterate: "Repeat until clean or max 3 passes"
    
    example_cascade:
      violation_detected: "p02_delete: speculative_generality in codex section"
      risk_assessment: "low (no security/data impact)"
      strategy: "single_auto_fix"
      cross_refs_check: ["p05_simple: unnecessary_abstraction", "p09_readable: high_cognitive_load"]
      auto_fix_applied: ["remove_unused", "flatten_hierarchy"]
      verification: "Check p01_works still satisfied after deletion"
      result: "Cleaner master.yml, fewer lines, same functionality"
    
    example_tournament:
      violation_detected: "p07_security: unvalidated_input in authentication"
      risk_assessment: "critical (security kernel principle)"
      strategy: "tournament_mode"
      alternatives_generated: 15
      synthesis: "Best validation from A, best error_handling from C, best logging from F"
      result: "Hybrid solution scores higher than any single alternative"

# UNIFIED PRINCIPLES - All engineering wisdom flattened for auto-iteration
# Each principle has cross-references to related principles for interconnected improvement
principles:
  interpretation: "Match by SPIRIT (70% threshold), not just letter"
  auto_fix_enabled: true
  veto_on_kernel_violation: true
  auto_iteration_mode: true  # Self-runs trigger cascading improvements
  
  # TIER 1: KERNEL (Absolute, Veto Power, Cross-Referenced)
  kernel:
    count: 10
    interpretation_mode: "loose"
    threshold: 0.70
    meaning: "Match by SPIRIT, not just letter"
    
    p01_code_works_beauty:
      name: "Code works, beauty proves it"
      aliases: ["working_code", "tests_prove_correctness", "beauty_is_simplicity"]
      cross_refs: ["p03_evidence", "p06_fail_fast", "p10_iterate"]
      literal_violations: ["tests_fail", "runtime_errors", "incorrect_output"]
      loose_violations: ["untested_paths", "fragile_assumptions", "magic_values"]
      auto_fix: ["add_tests", "handle_errors", "validate_assumptions"]
      detects: ["DRY_violation", "KISS_violation", "untested_code"]
      bad_example: "Claims it works but has no tests"
      good_example: "Tests pass, 90% coverage, edge cases documented"
    
    p02_delete_until_it_hurts:
      name: "Delete until it hurts"
      aliases: ["yagni", "minimize_code", "ruthless_deletion"]
      cross_refs: ["p05_simple", "p09_readable"]
      literal_violations: ["dead_code", "unused_imports", "redundant_logic"]
      loose_violations: ["speculative_generality", "premature_abstraction", "feature_envy"]
      auto_fix: ["remove_unused", "inline_trivial", "merge_duplicates"]
      detects: ["DRY_violation", "bloat", "over_engineering"]
      bad_example: "Keep code 'just in case'"
      good_example: "Delete now, add back when actually needed"
    
    p03_evidence_over_intuition:
      name: "Evidence over intuition"
      aliases: ["measure_dont_guess", "benchmark_first", "data_driven"]
      cross_refs: ["p01_works", "p10_iterate"]
      literal_violations: ["unmeasured_claims", "gut_feel_decisions", "no_metrics"]
      loose_violations: ["cargo_cult", "premature_optimization", "assumed_performance"]
      auto_fix: ["add_benchmarks", "collect_metrics", "verify_assumptions"]
      detects: ["unproven_assumptions", "cargo_cult_patterns"]
      bad_example: "'It should be fast'"
      good_example: "Benchmarked: 1000 ops in 15ms ±2ms (n=100)"
    
    p04_explicit_over_implicit:
      name: "Explicit over implicit"
      aliases: ["zen_of_python_explicit", "no_magic", "transparent_behavior"]
      cross_refs: ["p09_readable", "p07_secure"]
      literal_violations: ["hidden_dependencies", "magic_numbers", "implicit_contracts"]
      loose_violations: ["assumed_context", "tribal_knowledge", "undocumented_behavior"]
      auto_fix: ["add_constants", "document_contracts", "make_visible"]
      detects: ["magic_numbers", "hidden_coupling", "implicit_dependencies"]
      bad_example: "sleep(300) # why 300?"
      good_example: "TIMEOUT_MS = 300 # API rate limit"
    
    p05_simple_over_clever:
      name: "Simple over clever"
      aliases: ["kiss", "avoid_cleverness", "boring_code_wins"]
      cross_refs: ["p02_delete", "p09_readable"]
      literal_violations: ["obfuscated_logic", "unnecessary_abstraction", "clever_tricks"]
      loose_violations: ["overengineering", "premature_generalization", "framework_worship"]
      auto_fix: ["simplify_logic", "flatten_hierarchy", "inline_indirection"]
      detects: ["KISS_violation", "over_abstraction", "unnecessary_complexity"]
      bad_example: "Monad transformer for null check"
      good_example: "if value.nil? return default"
    
    p06_fail_fast_fail_loud:
      name: "Fail fast, fail loud"
      aliases: ["crash_dont_corrupt", "validate_early", "loud_failures"]
      cross_refs: ["p01_works", "p08_failure_design"]
      literal_violations: ["silent_failures", "swallowed_exceptions", "ignored_errors"]
      loose_violations: ["optimistic_assumptions", "missing_validation", "deferred_checks"]
      auto_fix: ["add_validation", "raise_on_error", "log_failures"]
      detects: ["silent_errors", "deferred_validation", "swallowed_exceptions"]
      bad_example: "Catch all, log nothing"
      good_example: "Validate input, raise with detail"
    
    p07_security_by_default:
      name: "Security by default"
      aliases: ["secure_by_design", "defense_in_depth", "zero_trust"]
      cross_refs: ["p04_explicit", "p06_fail_fast"]
      literal_violations: ["unvalidated_input", "excessive_permissions", "plaintext_secrets"]
      loose_violations: ["security_by_obscurity", "missing_rate_limits", "weak_boundaries"]
      auto_fix: ["add_validation", "reduce_permissions", "encrypt_secrets"]
      detects: ["sql_injection", "xss", "weak_auth", "mass_assignment"]
      bad_example: "params[:id] in direct SQL query"
      good_example: "Validate integer, check ownership"
    
    p08_design_for_failure:
      name: "Design for failure"
      aliases: ["resilience", "defensive_programming", "assume_failure"]
      cross_refs: ["p06_fail_fast", "p10_iterate"]
      literal_violations: ["no_error_handling", "missing_rollback", "single_point_of_failure"]
      loose_violations: ["optimistic_paths_only", "untested_recovery", "assumed_availability"]
      auto_fix: ["add_error_handling", "implement_rollback", "add_redundancy"]
      detects: ["missing_error_handling", "no_rollback", "single_point_failure"]
      bad_example: "Assume database always available"
      good_example: "Retry with backoff, circuit breaker, cache"
    
    p09_write_for_future_readers:
      name: "Write for future readers"
      aliases: ["readable_code", "self_documenting", "cognitive_load"]
      cross_refs: ["p04_explicit", "p05_simple"]
      literal_violations: ["cryptic_names", "no_comments_on_why", "insider_knowledge_required"]
      loose_violations: ["context_dependent", "temporal_coupling", "assumed_familiarity"]
      auto_fix: ["rename_descriptively", "add_context_comments", "document_rationale"]
      detects: ["poor_naming", "missing_why_comments", "high_cognitive_load"]
      bad_example: "process_x(y, z)"
      good_example: "calculate_monthly_revenue(segment, year)"
    
    p10_iterate_with_evidence:
      name: "Iterate with evidence"
      aliases: ["incremental_improvement", "verify_each_step", "reversible_changes"]
      cross_refs: ["p01_works", "p03_evidence", "p08_failure"]
      literal_violations: ["big_bang_changes", "no_verification", "irreversible_commits"]
      loose_violations: ["insufficient_checkpoints", "delayed_validation", "assumption_chains"]
      auto_fix: ["break_into_steps", "add_verification", "enable_rollback"]
      detects: ["big_bang_refactor", "untested_changes", "irreversible_operations"]
      bad_example: "Rewrite auth system in one commit"
      good_example: "One endpoint at a time, test each, rollback ready"
  


codex:
  note: "Consolidated - no duplication with domain_shortcuts"
  patterns:
    - {name: graceful_degradation, domain: resilience, maps: ["p08_failure"], evidence: "partial service > total failure"}
    - {name: caching_strategy, domain: performance, maps: ["p03_evidence"], evidence: "amortizes expensive operations"}
    - {name: lazy_loading, domain: performance, maps: ["p02_delete"], evidence: "defers cost until needed"}
    - {name: database_per_service, domain: microservices, maps: ["p08_failure"], evidence: "loose coupling enables scaling"}
    - {name: api_versioning, domain: integration, maps: ["p10_iterate"], evidence: "backward compatibility during evolution"}
    - {name: observability_first, domain: operations, maps: ["p03_evidence"], evidence: "cannot fix what cannot measure"}
    - {name: infrastructure_as_code, domain: devops, maps: ["p10_iterate"], evidence: "reproducibility and version control"}
      
    - name: autonomous_execution
      domain: operations
      weight: 0.85
      evidence: "minimize human intervention, maximize efficiency"
      patterns:
        - "work_directly_not_documents: skip report generation, do actual work"
        - "fail_fast_adapt: when blocked, try alternative approach immediately"
        - "file_upload_for_complex_configs: heredoc escaping fails, upload files instead"
        - "parallel_independent_tasks: analyze Rails while deploying OpenBSD"
        - "sequential_dependent_tasks: complete Phase A before Phase B if dependent"
      anti_patterns:
        - "avoid: creating summary documents instead of doing work"
        - "avoid: fancy ASCII art in output"
        - "avoid: markdown planning files"
        - "avoid: extended analysis when action is clear"
      key_learnings: "OpenBSD config strict syntax, Rails auth/strong_params mandatory, pure zsh patterns, @shared_functions.sh for DRY"
      usage_count: 3
      
    - name: rails_security_checklist
      domain: web_security
      weight: 1.0
      evidence: "master.yml v206 security audit 2026-01-11"
      mandatory_checks:
        - "authentication: before_action :authenticate_user! on all controllers except index/show"
        - "authorization: verify @resource.user == current_user before modify/delete"
        - "strong_parameters: params.require(:model).permit(:allowed, :fields)"
        - "sql_injection: use Arel.sql() or prepared statements, never string interpolation"
        - "xss_protection: avoid html_safe unless necessary, rely on ERB auto-escaping"
        - "mass_assignment: only permit explicitly whitelisted attributes"
        - "acts_as_votable: use gem for voting, not custom Vote models"
      passed_apps: ["brgen.sh", "brgen_dating.sh", "brgen_marketplace.sh", "brgen_playlist.sh", "brgen_takeaway.sh", "brgen_tv.sh", "privcam.sh", "amber.sh", "blognet.sh", "baibl.sh"]
      intentionally_public:
        - "bsdports.sh: public package search, rate limiting recommended"
      refactoring_complete: "2026-01-11T09:42:00Z"
      compliance_rate: "10/10 (100%)"
      usage_count: 2

# =============================================================================
# EMPIRICAL METRICS (Research-validated thresholds)
# =============================================================================
empirical_metrics:
  sources:
    - "Liu 2024: Lost in the middle phenomenon"
    - "Peitek ICSE 2021: fMRI study on complexity"
    - "Cowan 2001: Working memory 4±1 chunks"
  
  thresholds:
    working_memory_chunks: { value: "4±1", source: "Cowan 2001" }
    nesting_depth: { value: "<=3", effect: "8% defect detection decrease per level" }
    cognitive_complexity: { value: "<=15" }
    function_length_sweet_spot: { value: "5-10 lines", note: "U-shaped defect curve" }
  
  llm_prompting:
    temperature:
      deterministic_code: "0.0-0.2"
      reasoning: "0.5-0.7"
      creative: "0.7-1.0"

# =============================================================================
# SHELL (Pure zsh patterns - no external forks)
# =============================================================================
shell:
  philosophy: no_external_forks_pure_zsh
  always: "set -euo pipefail"
  prefer_native_zsh: true
  modules_required: [zsh/mapfile, zsh/system]
  
  native_patterns:
    string_ops:
      remove_crlf: '${var//$''\r''/}'
      lowercase: '${(L)var}'
      uppercase: '${(U)var}'
      replace_all: '${var//search/replace}'
      trim_both: '${${var##[[:space:]]#}%%[[:space:]]#}'
    
    array_ops:
      match_pattern: '${(M)arr:#*pattern*}'
      exclude_pattern: '${arr:#*pattern*}'
      unique: '${(u)arr}'
      join: '${(j:,:)arr}'
      sort_asc: '${(o)arr}'
    
    replacements:
      awk: "zsh array/string operations"
      sed: "zsh parameter expansion"
      tr: "zsh case conversion"
      grep: "zsh pattern matching with (M) flag"
      cut: "zsh field splitting with (s:delim:)"
      uniq: "${(u)arr}"
      sort: "${(o)arr}"

# =============================================================================
# RUBY/RAILS (Hotwire, Stimulus, StimulusReflex)
# =============================================================================
ruby_rails:
  version_requirements:
    ruby: "3.3+"
    rails: "8.0+"
  
  rails_8_patterns:
    solid_queue: true
    solid_cache: true
    solid_cable: true
    propshaft_assets: true
    importmap_js: true
    no_node_required: true
  
  hotwire:
    turbo:
      turbo_frames: true
      turbo_streams: true
      turbo_morphing: true
      minimal_custom_js: true
      stream_actions: [append, prepend, replace, update, remove, morph, refresh]
    
    stimulus:
      controllers_single_responsibility: true
      data_attributes_over_ids: true
      targets_over_query_selectors: true
      values_for_configuration: true
      outlets_for_controller_communication: true
    
    stimulus_reflex:
      version: "3.5+"
      morphs: [page, selector, nothing]
      optimistic_updates: true
      prevent_full_page_refresh: true
    
    stimulus_components:
      url: "https://stimulus-components.com"
      prefer_over_custom: true
  
  detect:
    erb_sprawl:
      symptoms:
        - "partial_explosion: >5 partials for single feature"
        - "deep_partial_nesting: >3 levels"
        - "logic_in_views"
      fixes:
        - extract_to_view_component
        - use_turbo_frames
        - extract_to_stimulus
    
    divitis:
      symptoms:
        - "excessive_nesting: >5 div levels"
        - "non_semantic_markup"
        - "class_explosion: >10 utility classes"
      fixes:
        - use_semantic_html
        - extract_to_stimulus_component
        - turbo_frame_boundaries

# =============================================================================
# DESIGN SYSTEM (Form follows function, minimal, accessible)
# =============================================================================
design_system:
  philosophy:
    core: form_follows_function
    perfection: nothing_left_to_remove
    whitespace: exaggerated_negative_space
  
  typography:
    line_height: 1.6
    optimal_measure: 45_75_chars
    max_width: 680px
    system_fonts: [system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif]
    
    rules:
      line_height: { min: 1.4, optimal: 1.6, max: 2.0 }
      line_length: { min: 45ch, optimal: 65ch, max: 75ch }
    
    banned:
      fonts: [Comic Sans, Papyrus]
      practices: [all_caps_body, justified_without_hyphenation, center_aligned_body]
  
  layout:
    grid: 8px_base_unit
    spacing_scale: [8, 16, 24, 32, 40, 48, 64, 80, 96]
    responsive: mobile_first
    touch_targets: { min: 44px, optimal: 48px }
  
  css:
    modern_features: [flexbox, grid, container_queries, ":has()"]
    avoid: [floats_for_layout, absolute_positioning_for_layout, "!important"]
    
    semantic_html:
      required: [header, main, nav, article, section, aside, footer]
      never: div_for_everything
  
  flat_design:
    enforced: true
    forbidden: [shadows, gradients, borders, border_radius, 3d_effects, skeuomorphism]
    allowed: [flat_colors, typography, whitespace, iconography, pure_geometry]
    exceptions:
      focus_indicators: required_for_accessibility
  
  accessibility:
    standard: wcag_aa
    wcag_version: "2.2"
    contrast:
      text: "4.5:1"
      large_text: "3:1"
      ui_components: "3:1"
    keyboard: all_interactive_elements_navigable
    touch_targets: 44px_minimum

workflow:
  core_principle: "Work directly in source files, never create planning documents"
  autonomy: full
  tournament_mode_enabled: true
  cherry_pick_synthesis: true
  
  forbidden_actions: ["Creating TODO.md PLAN.md NOTES.md SUMMARY.md files", "Creating standalone utilities when function should be in @shared_functions.sh", "Creating template files when pattern should be embedded in generators", "Working in /tmp/ or temporary locations", "Creating tracking/status documents"]
  
  required_workflow:
    step_1_read_everything_first:
      rule: "ALWAYS read ALL relevant files completely before ANY analysis or changes"
      example: "User says 'refactor these apps' -> Read ALL .sh files first, then act"
      rationale: "Premature analysis causes false conclusions and wasted work"
      
    step_2_identify_patterns:
      rule: "Identify duplication across files, extract to @shared_functions.sh"
      example: "Same controller pattern in 5 apps -> create generate_secure_controller() function"
      anti_pattern: "Creating separate utility script or template file"
      
    step_3_edit_in_place:
      rule: "Modify source files directly, never create planning documents"
      example: "Edit brgen.sh to use new shared function"
      anti_pattern: "Creating REFACTORING_PLAN.md then following it"
      
    step_4_document_minimally:
      rule: "Update ONLY: master.yml learnings + each app's README.md"
      example: "Add security findings to master.yml, update brgen/README.md"
      anti_pattern: "Creating SECURITY_AUDIT_SUMMARY.md"
  
  file_modification_rules: ["Edit .sh for logic", "Edit .md for docs (README.md only)", "Edit master.yml for learnings", "Add to @shared_functions.sh for reusable code", "Never create new .md for planning"]
  
  zsh_patterns:
    preference: "Pure modern zsh, avoid bash-isms"
    array_declaration: "typeset -a items=(...)"
    parameter_expansion: "${var:a:h} not $(dirname $var)"
    conditionals: "[[ ]] not [ ]"
    heredocs: "Use with extreme caution in remote shells, prefer file upload"
    functions: "Add to @shared_functions.sh for reuse"
  
  refactoring_approach:
    not_line_by_line: true
    method: "Pattern-based: identify duplication, extract to functions, apply everywhere"
    example: |
      # Instead of editing 10 controllers line by line:
      # 1. Create generate_secure_controller() in @shared_functions.sh
      # 2. Replace controller generation in all 10 apps with function call
      # 3. Result: 100 lines replaced with 10 function calls
    
    when_line_by_line_acceptable:
      - "Fixing unique bugs in single file"
      - "SQL injection in one specific query"
      - "Single security hole in one controller"
    
    when_pattern_based_required:
      - "Same code in 3+ files"
      - "Security patterns across multiple apps"
      - "Controller/model generation logic"
  
  error_recovery:
    when_copilot_crashes:
      - "Don't create recovery documents"
      - "Check session state with list_powershell"
      - "Resume work directly in source files"
    
    when_approach_wrong:
      - "Stop immediately when user corrects"
      - "Acknowledge mistake concisely"
      - "Apply correct approach without explaining past mistakes repeatedly"
  
  self_reflection_learnings_2026_01_11:
    mistakes_made:
      - "Created 6 tracking documents (forbidden)"
      - "Created standalone utility scripts instead of shared functions"
      - "Didn't read all files first despite explicit instruction"
      - "Wasted time on false positive security audit"
      - "Multiple PowerShell session crashes due to heredoc escaping"
    
    correct_approach:
      - "Read ALL source files completely first"
      - "Extract patterns to @shared_functions.sh"
      - "Edit generator scripts directly"
      - "Update only master.yml + app README.md files"
      - "Use pattern-based refactoring, not line-by-line"
      - "For remote work: upload files, don't use heredocs"
    
    internalized_rules:
      - "No planning documents ever"
      - "Work in source files directly"
      - "Read first, act second"
      - "Pattern extraction over duplication"
      - "Modern zsh patterns only"
  
  adversarial:
    mode: active_solution_generation
    autonomy: full
    enabled: true
    required_frequency: per_major_version
    accept_anonymous: true
    log_external_findings: true
    weight_external_higher: true
    
    on_any_action:
      generate_alternatives: [5, 15]
      score_each_against_principles: true
      adversarial_review: true
      cherry_pick_synthesis: true
      apply_best_immediately: true
    
    plateau_detection:
      signals:
        - principle_score_delta_lt: 0.01
          window: 3
        - new_concerns_count: 0
          window: 3
      on_plateau:
        force_radical_divergence: true
        paradigms: [functional_core, data_oriented, minimal_brutalist, dsl_heavy]
        generate_count: 15
        then: resume_cherry_pick


adversarial:
  mode: active
  generate_alternatives: [5, 15]
  cherry_pick_best: true
  
  external_review_required: true
  note: "Single LLM context = simulated personas, not true adversarial"

structural_operations:
  purpose: "Reorganize code/content for clarity and maintainability"
  
  operations:
    defragment:
      detects: [excessive_sections, scattered_logic, fragmented_concerns]
      action: "Consolidate related items into cohesive units"
      examples:
        - "12 small files → 3 focused modules"
        - "8 YAML sections → 3 logical groups"
      
    decouple:
      detects: [tight_coupling, cascading_changes, hidden_dependencies]
      action: "Introduce interfaces, dependency injection, events"
      threshold: "coupling_score > 5"
      
    hoist:
      detects: [values_buried_deep, magic_numbers_scattered, constants_duplicated]
      action: "Extract to accessible scope (top of file, constants section)"
      examples:
        - "PORT buried in line 500 → constant at line 10"
        
    regroup:
      detects: [arbitrary_grouping, alphabetical_without_meaning, scattered_related]
      action: "Organize by LATCH (Location/Alphabet/Time/Category/Hierarchy)"
      priority: "Semantic meaning > alphabetical > chronological"
      
    reflow:
      detects: [poor_execution_flow, details_before_concepts, buried_main_path]
      action: "Apply stepdown rule: high-level → details"
      pattern: "Guard clauses at top, happy path linear, error handling at boundaries"
      
    consolidate:
      detects: [file_sprawl, excessive_file_count, fragmented_features]
      action: "Merge related files, reduce cognitive load"
      prerequisite: "Run tree scan before entering directory"
      anti_pattern: "Creating new file when existing file serves purpose"

autofix_engine:
  enabled: true
  confidence_threshold: 0.90
  
  safe_transformations:
    whitespace: true
    imports: true
    quotes: true
    commas: true
    
  transformation_strategies:
    duplication:
      - confidence: 0.95
        pattern: "exact_duplicate_3plus_occurrences"
        actions: ["extract_function", "extract_constant", "yaml_anchor", "merge_sections", "hoist_shared"]
        selection: "Generate all 5, score by simplicity + coupling reduction"
        
      - confidence: 0.90
        pattern: "similar_with_parameters"
        actions: ["parameterize", "strategy_pattern", "template_method"]
        selection: "Choose based on variability analysis"
    
    magic_numbers:
      confidence: 0.95
      pattern: "numeric_literal_used_multiple_times"
      actions: ["extract_constant_with_rationale"]
      format: "typeset -r NAME=VALUE  # Why this value"
    
    complex_conditionals:
      confidence: 0.85
      pattern: "nested_ifs_depth_3plus OR boolean_expression_length_80plus"
      actions: ["extract_boolean_function", "guard_clauses", "polymorphism", "lookup_table"]
      selection: "Choose simplest that maintains clarity"
    
    long_functions:
      confidence: 0.80
      pattern: "function_lines_50plus OR cyclomatic_complexity_10plus"
      actions: ["extract_helpers", "split_abstraction_levels", "command_pattern"]
      caution: "Preserve single responsibility, don't over-fragment"
      
  rollback_on_regression: true
  verification_required: true
  feedback_loop: "Track success rate per transformation type, adjust thresholds"
  
  formatting_auto_apply:
    general:
      indent: 2
      quotes: "double"
      line_length: 120
      threshold: "100% files formatted"
      
    zsh_specific:
      use_typeset: true
      use_print_over_echo: true
      parameter_expansion_preferred: true
      emulate_L_zsh_required: true
      
    ruby_specific:
      frozen_string_literal: true
      rubocop_rails_omakase: true
      
    rails_specific:
      convention_over_configuration: true
      solid_stack_default: true

selection:
  kernel_check:
    validate_all: true
    veto_on_violation: true
    note: "Validation is interpretive, not enforced"
   
  additional_checks:
    - interconnection_validation
    - evidence_sufficiency
    - reversibility_analysis
decision:
  devils_advocate:
    enabled: true
    min_counterarguments: 2
    require_response: true
   
  approval:
    require_explicit: true
    timeout: none
implement:
  mode: atomic
  rollback_on_failure: true
  create_checkpoint: true
  note: "Outputs configuration, cannot reload self"
verify:
  checks:
    - yaml_validity
    - interconnection_integrity
    - principle_compliance
    - evidence_completeness
   
  evidence_schema:
    required_fields:
      - source
      - confidence
      - timestamp
      - artifact_or_reference
     
    valid_sources:
      - empirical_test
      - static_analysis
      - peer_review
      - cited_research
      - measurement_data
      - external_validation
     
    invalid_sources:
      - "no source specified"
      - "circular reasoning"
      - "appeal to authority without data"
      - "self-assessment without external check"
     
    minimum_confidence: 0.6
   
  regression_detection: true
learn:
  capture:
    - uncomfortable_truths
    - surprised_by
    - would_do_differently
    - external_critique
   
  update_weights:
    enabled: true
    method: outcome_based
    decay_rate: 0.1
    half_life_days: 7
    requires_external_data: true
report:
  include:
    - violations_found
    - changes_applied
    - compliance_delta
    - uncomfortable_truths
    - lessons_learned
    - metrics
    - honest_limitations_encountered
observability:
  mode: dmesg_deep
  verbosity: high
 
  honest_note: "Timestamps are illustrative, not real execution measurements. Format simulates kernel logging for clarity, not actual system trace."
 
  format:
    style: kernel_trace
    timestamp: microseconds
    components: [timestamp, subsystem, severity, message, metrics]
   
    subsystem:
      format: bracket
      examples: [kernel, analyze, hostile, verify, external]
     
    severity:
      format: 4char_caps
      levels: [INFO, DETL, PASS, WARN, FAIL, CRIT, QUES, EVAL, METR]
     
    prompt:
      style: shell
      template: "{timestamp} ~/master. yml ❯ {message}"
      show_context: true
     
  spacing:
    between_lines: 2
    between_groups: 2
   
  density: high
  clarity: high
  brevity: true
# VALIDATION - Consolidated honesty about framework status
validation:
  status: UNVALIDATED
  
  honest_limitations:
    epistemological: ["Interpretive guidance not enforced", "Self-assessed scores not measured", "No ground truth", "Single LLM context simulates personas"]
    practical: ["Zero empirical evidence of improvement", "No A/B testing", "No user satisfaction data", "Cannot prove execution"]
    validation: ["UNVALIDATED", "Zero experiments", "Treat as hypothesis", "Require external validation before production"]
  
  measurement_reality:
    implemented: false
    can_measure: ["output_token_count", "user_override_frequency", "external_review_findings"]
    cannot_measure: ["true_latency", "true_accuracy", "user_satisfaction", "task_completion", "cost_overhead"]
    
  external_validation:
    status: REQUIRED
    current_evidence: NONE
    required_experiments: ["A/B test N=100 blind raters p<0.05", "User survey N>=50", "Expert review blind", "Failure tracking"]
    falsification_criteria: ["Framework worse than vanilla", "Satisfaction <3.0/5.0", "Expert preference <50%", ">2x overhead no gain"]
# Active session: 2026-01-11T10:23Z - v219 self-run complete, 4 violations fixed (p02 bloat, p09 readability)