<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Warp Orb</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{background:#000}
canvas{position:fixed;inset:0;width:100%;height:100%;image-rendering:pixelated;image-rendering:crisp-edges}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
// 8-bit palette (256 colors)
const PAL=[];
for(let r=0;r<6;r++)for(let g=0;g<7;g++)for(let b=0;b<6;b++)PAL.push([r*51,g*42,b*51]);
for(let i=0;i<4;i++)PAL.push([i*85,i*85,i*85]);
function quantize(r,g,b){
  let best=PAL[0],minD=Infinity;
  for(const c of PAL){const d=(r-c[0])**2+(g-c[1])**2+(b-c[2])**2;if(d<minD){minD=d;best=c}}
  return best;
}

const canvas=document.getElementById('c'),ctx=canvas.getContext('2d',{willReadFrequently:true});
let w,h,scale=2,audio=0,time=0;
let rings=[],stars=[];

function resize(){
  w=Math.floor(window.innerWidth/scale);
  h=Math.floor(window.innerHeight/scale);
  canvas.width=w;canvas.height=h;
  initRings();initStars();
}

function initRings(){
  rings=[];
  for(let z=-200;z<200;z+=25){
    rings.push({z,phase:Math.random()*Math.PI*2});
  }
}

function initStars(){
  stars=[];
  for(let i=0;i<80;i++){
    stars.push({
      x:(Math.random()-0.5)*w*3,
      y:(Math.random()-0.5)*h*3,
      z:Math.random()*400-200
    });
  }
}

function draw(){
  time+=0.016;
  const speed=2+audio*4;
  const cx=w/2,cy=h/2,fov=150;
  
  ctx.fillStyle='rgba(10,10,12,0.2)';
  ctx.fillRect(0,0,w,h);
  
  const img=ctx.getImageData(0,0,w,h);
  
  // Stars
  for(const star of stars){
    star.z-=speed*0.5;
    if(star.z<-200){star.z+=400;star.x=(Math.random()-0.5)*w*3;star.y=(Math.random()-0.5)*h*3}
    
    const sc=fov/(fov+star.z);
    const sx=Math.floor(cx+star.x*sc);
    const sy=Math.floor(cy+star.y*sc);
    
    if(sx>=0&&sx<w&&sy>=0&&sy<h){
      const bright=Math.floor(100+((200-star.z)/400)*155);
      const q=quantize(bright,bright,252);
      const i=(sy*w+sx)*4;
      img.data[i]=q[0];img.data[i+1]=q[1];img.data[i+2]=q[2];img.data[i+3]=255;
    }
  }
  
  // Rings
  for(const ring of rings){
    ring.z-=speed;
    if(ring.z<-200)ring.z+=400;
    
    const sc=fov/(fov+ring.z);
    const radius=Math.floor(40*sc+audio*20*sc);
    const depth=(ring.z+200)/400;
    
    // Draw ring as pixels
    for(let a=0;a<Math.PI*2;a+=0.15){
      const wobble=Math.sin(a*4+time*2+ring.phase)*3*audio;
      const r=radius+wobble;
      const px=Math.floor(cx+Math.cos(a)*r);
      const py=Math.floor(cy+Math.sin(a)*r);
      
      if(px>=0&&px<w&&py>=0&&py<h){
        // Blue/cyan warp color
        const hue=200+depth*40+audio*30;
        const lit=0.3+depth*0.4;
        
        // Simple HSL approximation for blues
        let R=Math.floor(50+depth*100);
        let G=Math.floor(100+depth*80);
        let B=Math.floor(180+depth*75);
        
        const q=quantize(R,G,B);
        const dith=((px+py)%2)*20-10;
        
        const i=(py*w+px)*4;
        img.data[i]=Math.min(255,q[0]+dith);
        img.data[i+1]=Math.min(255,q[1]+dith);
        img.data[i+2]=Math.min(255,q[2]+dith);
        img.data[i+3]=255;
      }
    }
  }
  
  ctx.putImageData(img,0,0);
  requestAnimationFrame(draw);
}

navigator.mediaDevices?.getUserMedia({audio:true}).then(s=>{
  const ac=new AudioContext(),src=ac.createMediaStreamSource(s),an=ac.createAnalyser();
  an.fftSize=256;src.connect(an);
  const data=new Uint8Array(an.frequencyBinCount);
  (function loop(){
    an.getByteFrequencyData(data);
    let sum=0;for(let i=0;i<50;i++)sum+=data[i];
    audio=sum/50/255;
    requestAnimationFrame(loop);
  })();
}).catch(()=>{});

resize();
window.addEventListener('resize',resize);
draw();
</script>
</body>
</html>
initStars();
requestAnimationFrame(draw);
</script>
</body>
</html>
