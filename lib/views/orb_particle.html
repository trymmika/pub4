<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Thought Orb</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{background:#0a0a12;display:flex;align-items:center;justify-content:center}
#wrap{position:relative;image-rendering:pixelated;image-rendering:crisp-edges}
canvas{display:block;image-rendering:pixelated;image-rendering:crisp-edges}
#c{position:absolute;top:0;left:0}
#grain{position:absolute;top:0;left:0;pointer-events:none;opacity:0.08;mix-blend-mode:overlay}
#halation{position:absolute;top:0;left:0;pointer-events:none;mix-blend-mode:screen;opacity:0.4}
</style>
</head>
<body>
<div id="wrap">
<canvas id="c"></canvas>
<canvas id="halation"></canvas>
<canvas id="grain"></canvas>
</div>
<script>
var ctx,mid,dots=[],clusters=[],audio=0,thought=0;
var maxForce=0.08,wanderStrength=0.3,cohesion=0.02;
var halCtx,grainCtx;

function Vector(x,y){this.x=x;this.y=y}
Vector.prototype.add=function(v){this.x+=v.x;this.y+=v.y};
Vector.prototype.sub=function(v){this.x-=v.x;this.y-=v.y};
Vector.prototype.mult=function(n){this.x*=n;this.y*=n};
Vector.prototype.norm=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};
Vector.prototype.normalize=function(){var n=this.norm();if(n>0){this.x/=n;this.y/=n}};
Vector.prototype.limit=function(max){if(this.norm()>max){this.normalize();this.mult(max)}};
Vector.prototype.copy=function(){return new Vector(this.x,this.y)};

function Dot(x,y,cluster){
  this.pos=new Vector(x,y);
  this.vel=new Vector((Math.random()-0.5)*2,(Math.random()-0.5)*2);
  this.acc=new Vector(0,0);
  this.cluster=cluster;
  this.phase=Math.random()*Math.PI*2;
  this.speed=0.5+Math.random()*0.5;
}

Dot.prototype.wander=function(){
  this.phase+=0.02*this.speed;
  var wanderX=Math.cos(this.phase)*wanderStrength;
  var wanderY=Math.sin(this.phase*1.3)*wanderStrength;
  this.acc.add(new Vector(wanderX,wanderY));
};

Dot.prototype.seek=function(target){
  var des=target.copy();
  des.sub(this.pos);
  var d=des.norm();
  var speed=d<50?d*0.05:2;
  des.normalize();
  des.mult(speed);
  des.sub(this.vel);
  des.limit(maxForce+audio*0.1);
  return des;
};

Dot.prototype.cohere=function(){
  var center=clusters[this.cluster];
  var steer=this.seek(center);
  steer.mult(cohesion+thought*0.03);
  this.acc.add(steer);
};

Dot.prototype.constrain=function(){
  var d=Math.sqrt(Math.pow(this.pos.x-mid.x,2)+Math.pow(this.pos.y-mid.y,2));
  var radius=180+audio*30;
  if(d>radius){
    var angle=Math.atan2(this.pos.y-mid.y,this.pos.x-mid.x);
    this.pos.x=mid.x+Math.cos(angle)*radius;
    this.pos.y=mid.y+Math.sin(angle)*radius;
    this.vel.mult(-0.5);
  }
};

Dot.prototype.update=function(){
  this.wander();
  this.cohere();
  this.vel.add(this.acc);
  this.vel.limit(3+audio*2);
  this.pos.add(this.vel);
  this.acc.mult(0);
  this.constrain();
};

function rand(){return Math.random()-0.5}

function setup(){
  var canvas=document.getElementById('c');
  var w=150,h=150; // Low res for 8-bit look
  canvas.width=w;canvas.height=h;
  canvas.style.width='450px';canvas.style.height='450px';
  ctx=canvas.getContext('2d');
  ctx.imageSmoothingEnabled=false;
  mid=new Vector(w/2,h/2);
  
  // Halation layer (film bloom on highlights)
  var hal=document.getElementById('halation');
  hal.width=w;hal.height=h;
  hal.style.width='450px';hal.style.height='450px';
  halCtx=hal.getContext('2d');
  halCtx.imageSmoothingEnabled=false;
  
  // Film grain layer
  var grain=document.getElementById('grain');
  grain.width=w;grain.height=h;
  grain.style.width='450px';grain.style.height='450px';
  grainCtx=grain.getContext('2d');
  
  // Wrap size
  document.getElementById('wrap').style.width='450px';
  document.getElementById('wrap').style.height='450px';
  
  // Create cluster centers that drift like thoughts
  for(var i=0;i<5;i++){
    var angle=i*Math.PI*2/5;
    var r=20+Math.random()*13;
    clusters.push(new Vector(mid.x+Math.cos(angle)*r,mid.y+Math.sin(angle)*r));
  }
  
  // Fewer particles for 8-bit look
  for(var i=0;i<200;i++){
    var cluster=i%5;
    var cx=clusters[cluster].x;
    var cy=clusters[cluster].y;
    dots.push(new Dot(cx+rand()*13,cy+rand()*13,cluster));
  }
}

function moveClusters(){
  thought+=0.01;
  for(var i=0;i<clusters.length;i++){
    var phase=thought+i*Math.PI*2/5;
    var r=20+Math.sin(phase*0.7)*10+audio*13;
    clusters[i].x=mid.x+Math.cos(phase)*r;
    clusters[i].y=mid.y+Math.sin(phase*1.1)*r;
  }
}

function drawGrain(){
  // Film grain - Kodak Tri-X style
  var img=grainCtx.createImageData(150,150);
  for(var i=0;i<img.data.length;i+=4){
    var v=128+(Math.random()-0.5)*80;
    img.data[i]=img.data[i+1]=img.data[i+2]=v;
    img.data[i+3]=25+Math.random()*15;
  }
  grainCtx.putImageData(img,0,0);
}

function drawHalation(){
  // Film halation - warm glow bleeding from highlights
  halCtx.clearRect(0,0,150,150);
  
  // Get bright areas and add warm bloom
  for(var i=0;i<clusters.length;i++){
    var cx=clusters[i].x;
    var cy=clusters[i].y;
    var intensity=0.3+audio*0.4;
    
    // Warm orange-red halation glow
    var grad=halCtx.createRadialGradient(cx,cy,0,cx,cy,25+audio*10);
    grad.addColorStop(0,'rgba(255,120,60,'+intensity+')');
    grad.addColorStop(0.5,'rgba(255,80,40,'+(intensity*0.5)+')');
    grad.addColorStop(1,'rgba(255,40,20,0)');
    halCtx.fillStyle=grad;
    halCtx.fillRect(0,0,150,150);
  }
}

function draw(){
  // Lifted blacks (film toe) - never pure black
  ctx.fillStyle='rgba(12,12,20,0.25)';
  ctx.fillRect(0,0,150,150);
  
  moveClusters();
  
  // 8-bit color palette - limited hues, Portra-warm
  var hue=Math.floor((35+audio*20+Math.sin(thought)*15)/20)*20;
  
  for(var i=0;i<dots.length;i++){
    var dot=dots[i];
    dot.update();
    
    var alpha=0.6+audio*0.3;
    var px=Math.floor(dot.pos.x);
    var py=Math.floor(dot.pos.y);
    // Warm Kodak palette
    ctx.fillStyle='hsla('+hue+',65%,60%,'+alpha+')';
    ctx.fillRect(px,py,2,2);
  }
  
  // Film effects
  if(Math.random()<0.2)drawGrain();
  drawHalation();
  
  requestAnimationFrame(draw);
}

navigator.mediaDevices.getUserMedia({audio:true}).then(function(s){
  var ac=new AudioContext(),src=ac.createMediaStreamSource(s),an=ac.createAnalyser();
  an.fftSize=256;src.connect(an);
  var data=new Uint8Array(an.frequencyBinCount);
  (function loop(){
    an.getByteFrequencyData(data);
    var sum=0;for(var i=0;i<50;i++)sum+=data[i];
    audio=sum/50/255;
    requestAnimationFrame(loop);
  })();
}).catch(function(){});

setup();
requestAnimationFrame(draw);
</script>
</body>
</html>
