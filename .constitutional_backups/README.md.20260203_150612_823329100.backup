# Constitutional AI v47.6 ‚Äì The Code Janitor That Roasts You ü§ñüíÖ

Your code is a beautiful disaster. This tool quietly makes it better.

## Quick Start

```bash
export OPENROUTER_API_KEY="your-key"
ruby cli.rb .                    # analyze everything
ruby cli.rb --watch .            # watch mode
ruby cli.rb --garden-full        # self-improve constitution
```

## v47.6 Features

| Feature | Description |
|---------|-------------|
| **Tiered Pipeline** | Fast (Qwen) ‚Üí Medium (Sonnet) ‚Üí Strong (Opus) = 60-80% savings |
| **Prompt Caching** | System prompts cached 1h = 75-90% savings |
| **Parallel Detectors** | 8-12 concurrent cheap scans |
| **Gardener** | `--garden` / `--garden-full` self-improves constitution |
| **History Tracking** | `.constitutional_history.json` for painful cases |
| **Watch Mode** | `--watch` auto-reanalyze on save |
| **Auto-Bootstrap** | Gems install automatically |

## Commands

```bash
ruby cli.rb file.rb              # single file
ruby cli.rb src/                 # directory
ruby cli.rb --json **/*.rb       # CI mode
ruby cli.rb --watch .            # watch mode
ruby cli.rb --garden             # review learned smells
ruby cli.rb --garden-full        # full self-improvement
ruby cli.rb --cost               # show LLM spending
ruby cli.rb --rollback file.rb   # restore backup
```

## Safety

- üîí File locking (concurrent-safe)
- ‚Ü©Ô∏è Transactional rollback (`.constitutional_backups/`)
- üí∞ Cost protection ($1/file, $10/session)
- üîÑ Convergence detection (stops loops)
- ‚öñÔ∏è Priority-aware (won't make things worse)

## Cross-Platform

‚úÖ OpenBSD | ‚úÖ Termux | ‚úÖ macOS | ‚úÖ Linux | ‚úÖ Windows/Cygwin

## Architecture

```
cli.rb ‚ü∑ master.yml (symbiotic pair)

Core (pure functions):
  PrincipleRegistry, LLMDetector, ScoreCalculator, SkillLoader

Shell (IO/state):
  Constitution, LLMClient, TieredLLM, ParallelDetector, Gardener
```

## 32 Principles

1. **Axioms** (P10): Clarity, Simplicity, Explicit > Implicit
2. **SOLID** (P7-8): SRP, OCP, LSP, ISP, DIP
3. **Clean Code** (P6-7): Names, Small Functions, CQS
4. **Operations** (P9): Idempotent, Safe Refactoring

## Environment

```bash
OPENROUTER_API_KEY   # required for AI
VERBOSE=1            # debug mode
```

---

*May your code be clean and your merge conflicts few.* üôè
