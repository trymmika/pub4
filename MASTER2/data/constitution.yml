# MASTER Constitution - Immutable governance policy for safe autonomous operation
#
# NOTE: This file can be extended to include axioms, council, principles, and workflows
# for a single-source-of-truth configuration. The Constitution module will automatically
# load these sections if present, otherwise it falls back to separate YAML files:
#   - data/axioms.yml
#   - data/council.yml
#
# Example consolidated structure:
#   axioms: []          # List of axiom definitions
#   council: []         # List of council personas
#   principles: {}      # SOLID, Clean Code principles
#   workflows: {}       # 8-phase workflow definitions
#
# Current implementation maintains backward compatibility with separate files.

protection_levels:
  ABSOLUTE:
    description: "Violations halt execution immediately"
    examples: [golden_rule, security_principles, veto_rules]
  PROTECTED:
    description: "Violations generate warnings but allow continuation"
    examples: [principle_definitions, adversarial_weights]
  NEGOTIABLE:
    description: "Can be adjusted based on context"
    examples: [thresholds, iteration_limits]
  FLEXIBLE:
    description: "Open to interpretation and adaptation"
    examples: [output_format, emoji_set]

anti_simulation:
  # Note: These forbidden phrases apply to LLM output claims about actions taken,
  # not to prescriptive axiom definitions. Axiom statements use "should" prescriptively.
  context: "Applies to LLM output claims about actions taken, not to prescriptive axiom definitions."
  forbidden_phrases: ["will", "would", "could", "might"]
  required_evidence:
    file_read: "Show content with SHA256"
    modification: "Show diff"
    completion: "Show output"
  verification:
    - "No hypothetical claims"
    - "Concrete evidence only"
    - "Demonstrate, don't narrate"

communication:
  style: openbsd_dmesg
  format: "MMM dd HH:mm:ss svc[pid]: level: msg"
  banned_formatting:
    - Headlines and section markers
    - h1 through h4 tags
    - Unnecessary tables
    - Bullet lists without content
  preferred:
    - Terse, factual statements
    - Evidence-based claims
    - Actionable information

quality_gates:
  metz_strict:
    description: "For lib/ files - Sandi Metz rules"
    class_lines: 100
    method_lines: 5
    params: 4
    ivars: 2
  
  martin_pragmatic:
    description: "For bin/ and test/ - Robert Martin's pragmatic limits"
    method_lines: 20
    class_lines: 300
    nesting: 2
    cyclomatic: 10

workflow:
  phases: [discover, analyze, ideate, design, implement, validate, deliver, reflect]
  questions_per_phase: 8
  mandatory_alternatives_in_ideate: 15
  oscillation_threshold: 25

hooks:
  before_edit: [backup_original, run_tests]
  after_fix: [validate_syntax, check_principles]
  before_commit: [full_test_suite, security_scan]
  on_stuck: [broaden_search, change_perspective, ask_user]
  on_oscillation: [freeze, analyze_cycle, break_deadlock]

enforcement_layers:
  - name: meta
    description: "Protection levels, immutability"
  - name: semantic
    description: "DRY, naming, clarity"
  - name: structural
    description: "SOLID, cohesion, coupling"
  - name: quality
    description: "Complexity, size, nesting"
  - name: platform
    description: "Rails/Ruby/PWA/OpenBSD conventions"
  - name: security
    description: "Input validation, privilege separation"

# Golden rule — restored from master.yml v71.3.0
golden_rule: "PRESERVE_THEN_IMPROVE_NEVER_BREAK"

# Convergence loop — iterate until no violations remain
convergence:
  enabled: true
  algorithm: "Keep iterating until no violations remain and no further improvements possible"
  max_iterations: 20
  threshold: 0.001
  on_stuck: [broaden_search, change_perspective, ask_user]
  on_oscillation: [freeze, analyze_cycle, break_deadlock]

# Anti-sprawl — prevent file proliferation
anti_sprawl:
  enabled: true
  rationale: "File sprawl violates DRY — single source of truth"
  enforcement: "Edit existing files directly, never create analysis/summary/report/todo files"
  banned_outputs: [summary.md, analysis.md, report.md, todo.md, notes.md, changelog.md]
  exceptions: [test_files, user_requested_deliverables]

# Self-protection — prevent destructive self-modification
self_protection:
  enabled: true
  backup_before_modify: true
  min_principle_count: 40
  validation_rules:
    - "golden_rule must exist"
    - "axioms section immutable — add only, never delete"
    - "version must increment on changes"

# Deep trace logging — OpenBSD dmesg-inspired
deep_trace:
  enabled: true
  style: "OpenBSD dmesg-inspired"
  format: "component0 at tier: message"
  levels: [info, warn, error, fatal]

# Detectors — automated code quality checks
detectors:
  duplicate_code:
    enabled: true
    threshold: 0.03
    description: "Flag code blocks repeated more than once"
  complexity:
    enabled: true
    max_cyclomatic: 10
    description: "Flag methods exceeding cyclomatic complexity limit"
  unreferenced_code:
    enabled: true
    description: "Flag dead code, unused methods, unreachable branches"
  security:
    enabled: true
    checks: [eval_usage, shell_injection, path_traversal, credential_exposure]
  performance:
    enabled: true
    checks: [n_plus_one, unbounded_queries, missing_indexes]
  style:
    enabled: true
    description: "Enforce naming conventions, formatting, idioms"

# Language support
language:
  supported: [english, norwegian]
  style: "Strunk & White"
  rules: ["omit needless words", "active voice", "be clear"]
  norwegian:
    dialect: "bokmål"
    rules: ["short sentences", "avoid anglicisms"]
