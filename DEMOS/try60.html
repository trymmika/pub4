<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>Audio Reactive Torii Gate</title>
<script src="css-doodle.js"></script>
<style>
body { margin: 0; height: 100vh; display: grid; place-items: center; background: linear-gradient(to bottom, #1a1a2e 0%, #2d2d44 100%); }
#start { position: fixed; top: 20px; left: 20px; padding: 10px 20px; cursor: pointer; font: 14px system-ui; background: #333; color: #fff; border: none; }
</style></head><body>
<button id="start">start audio</button>
<css-doodle id="doodle">
  :doodle { @grid: 5 x 1; width: 300px; height: 350px; gap: 0; }
  @place-cell: center;
  position: absolute;
  --w: @pick(8px, 8px, 200px, 8px, 8px);
  --h: @pick(280px, 280px, 12px, 12px, 12px);
  --x: @pick(-80px, 80px, 0, 0, 0);
  --y: @pick(20px, 20px, -100px, -60px, 80px);
  width: calc(var(--w) + var(--bass, 0) * 5px);
  height: calc(var(--h) + var(--bass, 0) * 10px);
  left: calc(50% + var(--x));
  top: calc(50% + var(--y));
  transform: translate(-50%, -50%);
  background: hsl(0, calc(70% + var(--mid, 0) * 20%), calc(35% + var(--high, 0) * 15%));
  box-shadow: 0 0 calc(10px + var(--bass, 0) * 20px) hsla(0, 80%, 40%, calc(0.3 + var(--mid, 0) * 0.4));
  transition: all 0.1s ease-out;
</css-doodle>
<script>
const doodle = document.getElementById('doodle');
let ctx, analyser, data;

document.getElementById('start').onclick = async () => {
  ctx = new AudioContext();
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const src = ctx.createMediaStreamSource(stream);
  analyser = ctx.createAnalyser();
  analyser.fftSize = 256;
  src.connect(analyser);
  data = new Uint8Array(analyser.frequencyBinCount);
  document.getElementById('start').style.display = 'none';
  animate();
};

function animate() {
  analyser.getByteFrequencyData(data);
  const bass = data.slice(0, 10).reduce((a, b) => a + b, 0) / 2550;
  const mid = data.slice(10, 50).reduce((a, b) => a + b, 0) / 10200;
  const high = data.slice(50, 100).reduce((a, b) => a + b, 0) / 12750;
  doodle.style.setProperty('--bass', bass.toFixed(3));
  doodle.style.setProperty('--mid', mid.toFixed(3));
  doodle.style.setProperty('--high', high.toFixed(3));
  requestAnimationFrame(animate);
}
</script>
</body></html>
