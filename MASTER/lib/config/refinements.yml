# Micro-refinement opportunities
# Run: chamber refine or queue add lib/
---
refinements:

  # Boot sequence
  - file: lib/boot.rb
    line: 19
    desc: Add kernel build date from git log
    effort: low

  - file: lib/boot.rb
    line: 25
    desc: Show CPU frequency if available
    effort: low

  - file: lib/boot.rb
    line: 71
    desc: Add entropy source detection
    effort: medium

  # LLM efficiency
  - file: lib/llm.rb
    line: 110
    desc: Add request compression for large prompts
    effort: medium

  - file: lib/llm.rb
    line: 42
    desc: Implement semantic cache (embeddings-based)
    effort: high

  - file: lib/llm.rb
    line: 197
    desc: Dynamic principle loading based on task type
    effort: medium

  - file: lib/llm.rb
    line: 114
    desc: Add streaming support for long responses
    effort: high

  # CLI improvements
  - file: lib/cli.rb
    line: 113
    desc: Add readline vi mode support
    effort: low

  - file: lib/cli.rb
    line: 120
    desc: Show spinner with elapsed time
    effort: low

  - file: lib/cli.rb
    line: 343
    desc: Add context-aware help (show relevant commands)
    effort: medium

  - file: lib/cli.rb
    line: 482
    desc: Batch multiple LLM calls in refactor
    effort: medium

  # Web browser
  - file: lib/web.rb
    line: 20
    desc: Add cookie/session persistence
    effort: medium

  - file: lib/web.rb
    line: 25
    desc: Extract structured data (tables, lists)
    effort: medium

  - file: lib/web.rb
    line: 17
    desc: Add JavaScript execution timeout
    effort: low

  - file: lib/web.rb
    line: 32
    desc: Return markdown instead of plain text
    effort: low

  # Server and orbs
  - file: lib/server.rb
    line: 99
    desc: Add SSE endpoint for real-time orb updates
    effort: medium

  - file: lib/server.rb
    line: 103
    desc: Stream LLM response tokens to orb
    effort: high

  - file: cli.html
    line: 100
    desc: Connect orb animation speed to token rate
    effort: medium

  - file: cli.html
    line: 21
    desc: Auto-detect mood from response sentiment
    effort: medium

  # Chamber improvements
  - file: lib/chamber.rb
    line: 30
    desc: Add parallel model calls with Thread pool
    effort: medium

  - file: lib/chamber.rb
    line: 19
    desc: Configurable cost limits per file type
    effort: low

  - file: lib/creative_chamber.rb
    line: 40
    desc: Add voting/scoring between models
    effort: medium

  - file: lib/creative_chamber.rb
    line: 75
    desc: Compare generated images visually (llava)
    effort: high

  # Introspection
  - file: lib/introspection.rb
    line: 10
    desc: Load hostile questions from YAML file
    effort: low

  - file: lib/introspection.rb
    line: 50
    desc: Save reflection history to disk
    effort: low

  - file: lib/introspection.rb
    line: 80
    desc: Track principle violation patterns
    effort: medium

  # Queue system
  - file: lib/queue.rb
    line: 30
    desc: Add file dependency ordering
    effort: high

  - file: lib/queue.rb
    line: 50
    desc: Estimate cost before processing
    effort: medium

  - file: lib/queue.rb
    line: 70
    desc: Add pause/resume with keyboard interrupt
    effort: medium

  # Memory and context
  - file: lib/memory.rb
    line: 1
    desc: Add rolling summary compression
    effort: high

  - file: lib/memory.rb
    line: 1
    desc: Persist conversation across sessions
    effort: medium

  # Replicate
  - file: lib/replicate.rb
    line: 1
    desc: Add image-to-image generation
    effort: medium

  - file: lib/replicate.rb
    line: 1
    desc: Add audio transcription with Whisper
    effort: medium

  - file: lib/replicate.rb
    line: 1
    desc: Add music generation with MusicGen
    effort: medium

  # Principles
  - file: lib/principle.rb
    line: 1
    desc: Auto-apply principles based on file type
    effort: medium

  - file: lib/principles/
    desc: Add principle for error handling patterns
    effort: low

  - file: lib/principles/
    desc: Add principle for security-first design
    effort: low

  # Cross-platform
  - file: lib/openbsd.rb
    line: 1
    desc: Add pledge/unveil integration
    effort: high

  - file: lib/paths.rb
    line: 1
    desc: XDG base directory support
    effort: low

  # Testing
  - file: test/test_master.rb
    desc: Add chamber deliberation tests
    effort: medium

  - file: test/test_master.rb
    desc: Add mock LLM for offline testing
    effort: medium

  # --- Additional refinements (round 2) ---

  # Memory enhancements
  - file: lib/memory.rb
    line: 20
    desc: Use LLM to summarize old messages instead of truncation
    effort: high

  - file: lib/memory.rb
    line: 10
    desc: Add topic tagging for retrieval
    effort: medium

  - file: lib/memory.rb
    line: 15
    desc: Export session history to markdown
    effort: low

  # Safety hardening
  - file: lib/safety.rb
    line: 17
    desc: Add SQL injection patterns to DANGEROUS_RUBY
    effort: low

  - file: lib/safety.rb
    line: 28
    desc: Add allowlist mode for commands
    effort: medium

  - file: lib/safety.rb
    line: 40
    desc: Log blocked commands for security audit
    effort: low

  # Engine improvements
  - file: lib/engine.rb
    line: 21
    desc: Add cyclomatic complexity check
    effort: medium

  - file: lib/engine.rb
    line: 33
    desc: Detect duplicated code blocks
    effort: high

  - file: lib/engine.rb
    line: 25
    desc: Add YAML and JSON lint support
    effort: low

  # Replicate multimodal
  - file: lib/replicate.rb
    line: 26
    desc: Add image-to-image transformation
    effort: medium

  - file: lib/replicate.rb
    line: 36
    desc: Queue multiple predictions in batch
    effort: medium

  - file: lib/replicate.rb
    line: 66
    desc: Show progress bar during polling
    effort: low

  # Convergence refinements
  - file: lib/converge.rb
    line: 71
    desc: Use Levenshtein distance for change_ratio instead of binary hash compare
    effort: medium

  - file: lib/converge.rb
    line: 47
    desc: Add visual diff between iterations
    effort: medium

  - file: lib/converge.rb
    line: 30
    desc: Store convergence history to disk
    effort: low

  # Smells detection
  - file: lib/smells.rb
    line: 30
    desc: Add dead require detection
    effort: medium

  - file: lib/smells.rb
    line: 60
    desc: Detect inconsistent naming patterns
    effort: medium

  - file: lib/smells.rb
    line: 80
    desc: Add AST-based analysis with Prism gem
    effort: high

  # CLI usability
  - file: lib/cli.rb
    line: 42
    desc: Add command aliases (q for quit, h for help)
    effort: low

  - file: lib/cli.rb
    line: 56
    desc: Add undo command for file edits
    effort: high

  - file: lib/cli.rb
    line: 74
    desc: Fuzzy match command names with did_you_mean
    effort: low

  - file: lib/cli.rb
    line: 30
    desc: Add configurable prompt format
    effort: low

  # LLM efficiency
  - file: lib/llm.rb
    line: 56
    desc: Add token count preview before sending
    effort: low

  - file: lib/llm.rb
    line: 79
    desc: Retry with cheaper tier on rate limit
    effort: medium

  - file: lib/llm.rb
    line: 44
    desc: Add cache expiry by time and size
    effort: low

  # Boot polish
  - file: lib/boot.rb
    line: 50
    desc: Add network latency measurement to each provider
    effort: low

  - file: lib/boot.rb
    line: 80
    desc: Detect and report disk usage of lib directory
    effort: low
